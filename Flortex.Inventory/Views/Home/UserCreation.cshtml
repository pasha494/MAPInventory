@model Flortex.Inventory.Models.Users
@{
    ViewBag.Title = "UserCreation";
}


<form role="search" id="frmUsers" class="cmxform">
    @Html.HiddenFor(m => m.UserID)

    @if (Model.UserID > 0)
    {
        <div class="row-fluid">
            <div class="span12">
                <h2 class="subtitle">Create User</h2>
            </div>
        </div> 
    }
    else
    {         
        <div class="row-fluid">
            <div class="span12">
                <h2 class="subtitle">Edit User</h2>
            </div>
        </div>
    }
    <div class="row-fluid">
        <div class="span2">
            <label for="txtName" class="label">Name</label>
        </div>
        <div class="span8">
            <input type="text" class="form-control mousetrap" style="width: 250px" name="txtName" id="txtName" placeholder="Name.."  value="@Model.Name">
        </div>
    </div>

    <div class="row-fluid">
        <div class="span2">
            <label for="txtEmail" class="label">Email</label>
        </div>
        <div class="span8">
            <input type="text" class="form-control mousetrap" style="width: 250px" name="txtEmail" id="txtEmail" placeholder="Email.."  value="@Model.Email">
        </div>
    </div>

    <div class="row-fluid">
        <div class="span2">
            <label for="txtEmail" class="label">Password</label>
        </div>
        <div class="span8">
            <input type="password" class="form-control mousetrap" style="width: 250px" name="txtPassword" id="txtPassword" placeholder="Password.."  value="@Model.Email">
        </div>
    </div>

    <div class="row-fluid">
        <div class="span2">
            <label for="drpRole" class="label">Role</label>
        </div>
        <div class="span8">
            @*          @if (Model.IsAdmin)
            {
                <span class="label">Is Admin ?</span><input class="mousetrap" checked="checked" type="checkbox" id="chkAdmin" name="chkAdmin">
            }
            else
            {
                <span class="label">Is Admin ?</span><input class="mousetrap" type="checkbox" id="chkAdmin" name="chkAdmin">
            }*@

            @if (Model.RoleID > 0)
            {
                <input id="drpRole" value="@Model.RoleID"  class="form-control mousetrap" style="width: 250px" />
            }
            else
            {
                <input id="drpRole" class="form-control mousetrap" style="width: 250px" />
            }


        </div>
    </div>

    <div class="row-fluid">
        <div class="span2">
        </div>
        <div class="span8">
            <button type="submit" class="btn btn-default" id="btnCreateUser">
                Submit
            </button>

            <button class="btn btn-default" id="btnClear">Reset</button>
            <a class="btn btn-default" href="@Url.Action("Index", "Home")">Cancel</a>
        </div>

    </div>

</form>

<script type="text/javascript">

    $(function () {

        var data = [
                      { text: "-----------Select Role------------", value: "0" },
                      { text: "Admin", value: "1" },
                      { text: "Salesman", value: "2" },
                      { text: "Data Operator", value: "3" }
        ];

        // create DropDownList from input HTML element
        $("#drpRole").kendoDropDownList({
            dataTextField: "text",
            dataValueField: "value",
            dataSource: data,
            index: 0
        });


        $("#btnCreateUser").on("click", function (e) {
            e.preventDefault();
            _saveUsers();
        });

        var _saveUsers = function () {
            if ($("#frmUsers").valid()) {
                $.ajax({
                    url: '/Home/SaveUser',
                    type: 'post',
                    data: { "Data": createUser() },
                    beforeSend: function () {
                        $("#ajaxLoadingImg").show();
                    },
                    success: function (data) {
                        if (data > 0) {
                            if ($("#UserID").val() > 0)
                                customAlert('Updated Successfully.', 'alert', function () { $("#txtName").focus(); });
                            else
                                customAlert('Created Successfully.', 'alert', function () { $("#txtName").focus(); });
                            clearContorls();
                        }
                        else {
                            customAlert('Error occured', 'alert');
                        }
                    },
                    complete: function () { $("#ajaxLoadingImg").hide(); },
                    error: function (e) { customAlert('Error occured', 'alert'); }
                });
            }
        }

        $("#frmUsers").validate({
            rules: {
                txtName: { required: true },
                txtEmail: { required: true, email: true },
                txtPassword: { required: true },
                drpRole: {
                    required: true,
                    greaterThanZero: true
                },
            },
            messages: {
                txtName: "please enter product code.",
                txtEmail: { required: "please enter email.", email: "please enter a valid email address" },
                txtPassword: "please enter password.",
                drpRole: "please select Role."
            }
        });

        var clearContorls = function () {
            $("#UserID").val('0');
            $("#txtEmail").val('');
            $("#txtPassword").val('');
            $("#txtName").val('');
            $("#chkAdmin").removeAttr("checked");
            $("#txtName").focus();
        };

        var createUser = function () {

            _IsAdmin = false;
             
            var obj = {
                UserID: $("#UserID").val(),
                Name: $("#txtName").val(),
                Email: $("#txtEmail").val(),
                Password: $("#txtPassword").val(),
                RoleID: $("#drpRole").val(),
                IsAdmin: _IsAdmin
            }

            return JSON.stringify(obj);
        }

        $("#btnClear").on("click", function (e) {
            e.preventDefault();
            clearContorls();

        });


        if ('@Model.UserID' > 0 && '@Model.IsAdmin' == true) {
            $("#chkAdmin").attr("checked", "checked");
        }

        Mousetrap.bind(['ctrl+s', 'command+s'], function (e) {
            e.preventDefault();
            _saveUsers();
        });

        Mousetrap.bind(['ctrl+backspace', 'command+backspace'], function (e) {
            e.preventDefault();
            window.location.href = '@Url.Action("Users", "Home")';
        });


        Mousetrap.bind(['ctrl+r', 'command+r'], function (e) {
            e.preventDefault();
            clearContorls();
        });

        Mousetrap.bind(['ctrl+h', 'command+h'], function (e) {
            e.preventDefault();
            window.location.href = '@Url.Action("Index", "Home")';
        });

        $("#txtName").focus();

    });



</script>
